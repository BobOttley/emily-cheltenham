<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Emily Chatbot</title>
  <style>
    :root {
      --primary-color: #091825;
      --accent-color: #FF9F1C;
      --text-color: #fff;
      --chat-bg: #f9f9f9;
      --border-color: #e0e0e0;
      --button-bg: #f0f0f0;
      --button-fg: #444;
    }

    body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0; }

    #penai-toggle{
      position:fixed; bottom:20px; right:20px; width:60px; height:60px; border-radius:50%;
      background:var(--accent-color); color:#fff; font-size:28px; display:flex; align-items:center; justify-content:center;
      cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,.2); z-index:1000; transition:background .2s ease;
    }
    #penai-toggle:hover{ background:#e98f14; }

    #penai-chatbox{
      display:none; flex-direction:column; position:fixed; bottom:90px; right:20px; width:360px; max-height:600px;
      background:#fff; border:1px solid var(--border-color); border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,.15);
      z-index:999; overflow:hidden;
    }
    #penai-chatbox.open{ display:flex; animation:slideUp .3s ease-out; }
    @keyframes slideUp{ from{ transform:translateY(20px); opacity:0 } to{ transform:translateY(0); opacity:1 } }

    #penai-header{
      display:flex; align-items:center; gap:8px; padding:10px 12px; background:var(--primary-color); color:#fff;
    }
    #penai-header h2{ margin:0; font-size:16px; flex:1; }

    #penai-close{
      background:none; border:none; color:#fff; font-size:18px; cursor:pointer; line-height:1; padding:4px 6px;
      border-radius:6px; transition:background-color .2s ease;
    }
    #penai-close:hover{ background-color:rgba(255,255,255,.12); }

    #language-selector{
      font-size:12px; padding:3px 6px; border-radius:4px; border:1px solid #ccc; background:#fff; color:#000;
    }

    /* Header controls */
    .penai-ctl{
      padding:6px 10px; background:var(--button-bg); color:var(--button-fg); font-size:12px;
      border-radius:6px; border:1px solid #ccc; cursor:pointer; transition:background-color .2s ease, color .2s ease, border-color .2s ease;
    }
    .penai-ctl:hover{ background-color:var(--accent-color); color:#fff; border-color:var(--accent-color); }
    .hidden{ display:none !important; }

    #welcome-message{ padding:10px 15px; background:#f9f9f9; color:#091825; font-size:14px; }

    #chat-history{
      flex:1; padding:15px; padding-bottom:100px; overflow-y:auto; background:var(--chat-bg);
      border-top:1px solid var(--border-color); border-bottom:1px solid var(--border-color); scroll-behavior:smooth;
    }

    .message{
      margin-bottom:12px; padding:10px; font-size:14px; line-height:1.4; max-width:85%; word-wrap:break-word;
      border:1px solid #e0e0e0; border-radius:8px; background:#fff; box-shadow:0 1px 3px rgba(0,0,0,.05);
    }
    .message.user{ text-align:right; align-self:flex-end; color:#333; }
    .message.bot{ text-align:left; align-self:flex-start; color:#091825; }
    .message.bot p::before{ content:"Emily: "; font-weight:bold; }

    .chat-link{ display:block; margin-top:5px; text-decoration:underline; font-size:14px; color:#0056b3; }

    #button-grid{
      display:grid; grid-template-columns:repeat(3,1fr); gap:6px; padding:10px; background:#f1f1f1;
      border-top:1px solid #ddd; border-bottom:1px solid #ddd;
    }
    .quick-reply{
      padding:6px 8px; background:var(--button-bg); color:var(--button-fg); font-size:12px; border-radius:20px; border:1px solid #ccc;
      cursor:pointer; transition:background .2s ease;
    }
    .quick-reply:hover{ background:#e0e0e0; }

    #penai-input-container{ display:flex; padding:10px; background:#fff; border-bottom-left-radius:12px; border-bottom-right-radius:12px; }
    #question-input{ flex:1; padding:8px; border:1px solid var(--border-color); border-radius:5px; font-size:14px; }
    #send-button{
      margin-left:8px; padding:8px 12px; background:var(--primary-color); color:#fff; border:none; border-radius:5px; font-size:14px; cursor:pointer; transition:background-color .2s ease;
    }
    #send-button:hover{ background-color:#0c2235; }

    #thinking-text{ padding:10px 15px; display:none; font-style:italic; color:#777; }
    #thinking-text::after{ content:""; display:inline-block; width:1em; text-align:left; animation:dots 1.2s steps(3,end) infinite; }
    @keyframes dots{ 0%{content:""} 33%{content:"."} 66%{content:".."} 100%{content:"..."} }
  </style>
</head>

<body>

<div id="penai-toggle" aria-label="Open chat">ðŸ’¬</div>

<div id="penai-chatbox" aria-live="polite">
  <div id="penai-header">
    <h2>Chat with Emily</h2>

    <!-- Header language (kept, but consent modal is the primary place to pick) -->
    <select id="language-selector" aria-label="Language">
      <option value="en">ðŸ‡¬ðŸ‡§ English</option>
      <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
      <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
      <option value="de">ðŸ‡©ðŸ‡ª Deutsch</option>
      <option value="zh">ðŸ‡¨ðŸ‡³ ä¸­æ–‡</option>
      <option value="ar">ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
      <option value="it">ðŸ‡®ðŸ‡¹ Italiano</option>
    </select>

    <!-- Controls -->
    <button id="start-button" class="penai-ctl">Start conversation</button>
    <button id="pause-button" class="penai-ctl hidden" type="button">Pause</button>
    <button id="end-button" class="penai-ctl hidden" type="button">End chat</button>

    <button id="penai-close" type="button" aria-label="Close chat">âœ•</button>
  </div>

  <div id="welcome-message"></div>
  <div id="chat-history"></div>
  <div id="thinking-text">Thinking</div>
  <div id="button-grid"></div>

  <div id="penai-input-container">
    <input type="text" id="question-input" placeholder="Ask a questionâ€¦" />
    <button id="send-button">Send</button>
  </div>
</div>

<!-- Voice consent modal with language + localisation -->
<div id="voiceConsent" style="position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:9999;">
  <div style="background:#fff;padding:20px;border-radius:12px;max-width:460px;width:92%;box-shadow:0 8px 30px rgba(0,0,0,.2);">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:10px;">
      <h3 id="vc-title" style="margin:0">Enable Emily (voice)</h3>
      <select id="vc-lang" style="font-size:12px;padding:3px 6px;border-radius:4px;border:1px solid #ccc;background:#fff;color:#000;">
        <option value="en">ðŸ‡¬ðŸ‡§ English</option>
        <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
        <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
        <option value="de">ðŸ‡©ðŸ‡ª Deutsch</option>
        <option value="zh">ðŸ‡¨ðŸ‡³ ä¸­æ–‡</option>
        <option value="ar">ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="it">ðŸ‡®ðŸ‡¹ Italiano</option>
      </select>
    </div>
    <p id="vc-desc" style="margin:0 0 10px">To chat by voice, we need one-time permission to use your microphone and play audio responses.</p>
    <label style="display:block;margin:8px 0;">
      <input id="agreeVoice" type="checkbox"> <span id="vc-agree">I agree to voice processing for this session.</span>
    </label>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
      <button id="cancelVoice" type="button">Not now</button>
      <button id="startVoice" type="button" disabled>Start conversation</button>
    </div>
  </div>
</div>

<!-- Optional inline status -->
<div id="voiceIndicator" class="voice-indicator hidden" style="position:fixed;right:20px;bottom:700px;background:#fff;border:1px solid #ddd;border-radius:8px;padding:6px 10px;font-size:12px;box-shadow:0 4px 12px rgba(0,0,0,.1);">Ready</div>

<!-- Hidden audio element for AI replies -->
<audio id="aiAudio" autoplay playsinline></audio>

<!-- Voice initialiser -->
<script src="/static/realtime-voice-handsfree.js"></script>
<script src="/static/script.js"></script>
</body>
</html>
